---
title: "Waterways Buffer"
author: "Craig O'Neill"
date: "May 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Libraries Needed

```{r}
library(tidyverse)
library(sf)
library(leaflet)
library(sp)
library(rgdal)
library(mapview)
```

##Load in KMZ (KML only at the moment)


```{r}
#Load the KML
location <- choose.files() #KML Only now

#Process the Layer Names and Numbers
layers <- st_layers(location)
lname <- layers$name


#Load all Layers in a ForLoop
datalist = list()
for(i in 1:NROW(lname)){
  dat <- st_read(location, layer = lname[i])
  dat$i <- i
  datalist[[i]] <- dat
}

#Combine All Layers into 1 SF File
mapfile <- do.call(rbind, datalist)

#View Map
mapview(mapfile)
```

##Load in the Most Recent Waterways Shapefiles

```{r}
#water <- choose.files()

#CA Waterways Shapefiles
CAR <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Riparian.shp") #CA_Riparian
colnames(CAR) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")
CAWN <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Wetlands_North.shp") #CA Wetlands North
colnames(CAWN) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")
CAWNC <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Wetlands_NorthCentral.shp") #CA Wetlands North Central
colnames(CAWNC) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")
CAWS <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Wetlands_South.shp") #CA Wetlands South
colnames(CAWS) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")
CAWSC <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Wetlands_SouthCentral.shp") #CA Wetlands South Central
colnames(CAWSC) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")
CACA <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/California.shp") #California
colnames(CACA) <- c("Attribute", "Wetland_TY", "Acres", "Shape_Leng", "Shape_Area", "geometry")

CAWater <- rbind(CAR, CAWN, CAWNC, CAWS, CAWSC, CACA)
CAWater <- st_transform(CAWater, "+init=epsg:4326")

#Reproject
CAR <- st_transform(CAR, "+init=epsg:4326")
CAWN <- st_transform(CAWN, "+init=epsg:4326")
CAWNC <- st_transform(CAWNC, "+init=epsg:4326")
CAWS <- st


riparian <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Wetlands_South.shp")
riparian <- st_transform(riparian, "+init=epsg:4326")
riparianN <- st_read("CA_shapefile_wetlands/CA_shapefile_wetlands/CA_Riparian.shp")
riparianN <- st_transform(riparianN, "+init=epsg:4326")
CACounties <- st_read("CA_Counties/CA_Counties_TIGER2016.shp")
CACounties <-st_transform(CACounties, "+init=epsg:4326")
MBICounties <- subset(CACounties, NAME == "Kern" | NAME == "Fresno" | NAME == "Mariposa" | NAME == "Tulare" | NAME == "Kings" | NAME == "Madera" | NAME == "Merced")

CropWater <- st_intersection(MBICounties, CAWater)



mapview(MBICounties)+
  mapview(mapfile)


mapview(CropWater)+
  mapview(MBICounties)

```

